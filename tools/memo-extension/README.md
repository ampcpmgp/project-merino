# Merino Memo Extension

メモ管理用のChrome拡張機能です。

## 機能

- **メモ保存**: テキストメモを保存・管理
- **設定ダイアログ**: フォントサイズや自動保存の設定
- **変数設定**: メモで使用する変数の管理
- **適切なダイアログ管理**: ESCキーでダイアログを一つずつ確実に閉じる

## インストール方法

1. Chrome ブラウザを開く
2. `chrome://extensions/` にアクセス
3. 右上の「デベロッパーモード」を有効化
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. `tools/memo-extension` フォルダを選択

## 使用方法

### 基本操作

1. 拡張機能アイコンをクリックしてポップアップを開く
2. メモエリアにテキストを入力
3. 「保存」ボタンでメモを保存
4. 「クリア」ボタンでメモをクリア

### 設定ダイアログ

1. 右上の歯車アイコン⚙️をクリック
2. フォントサイズを変更（小/中/大）
3. 自動保存を有効/無効にする

### 変数設定ダイアログ

1. 設定ダイアログを開く
2. 「変数設定」ボタンをクリック
3. 変数を追加・編集・削除

### キーボード操作

- **ESC**: 最上位のダイアログを閉じる
  - ポップアップ → 設定ダイアログ → 変数設定ダイアログと開いた場合
  - ESCキー1回目: 変数設定ダイアログを閉じる
  - ESCキー2回目: 設定ダイアログを閉じる
  - ポップアップ自体は閉じない（一つずつ確実に閉じる）

## アーキテクチャ

### ダイアログ管理

`DialogManager`クラスが全ダイアログを一元管理：

- **dialogStack**: 開いているダイアログのスタック
- **open(id)**: ダイアログを開いてスタックに追加
- **close(id)**: 指定ダイアログまたは最上位のダイアログを閉じる
- **setupGlobalESCHandler()**: グローバルESCキーハンドラー

### 状態管理

`AppState`オブジェクトでアプリケーション状態を管理：

```javascript
{
    dialogStack: [],  // ダイアログスタック
    memoData: {
        text: '',         // メモテキスト
        fontSize: '',     // フォントサイズ
        autoSave: false,  // 自動保存
        variables: []     // 変数リスト
    }
}
```

### 新しいダイアログの追加方法

1. HTMLに新しいダイアログ要素を追加
2. `DialogManager.register()`で登録
3. 開くボタンに`DialogManager.open()`を設定
4. 閉じるボタンに`DialogManager.close()`を設定

ESCキーハンドリングは自動的に機能します。

## バージョン情報

### v1.0.0 (2026-02-09)

**新機能**
- 初回リリース
- メモ保存・管理機能
- 設定ダイアログ（フォントサイズ、自動保存）
- 変数設定ダイアログ
- 適切なダイアログスタック管理
- ESCキーで一つずつダイアログを閉じる機能

**改善点**
- クリーンで読みやすいコード構造
- メンテナンスしやすいダイアログ管理システム
- 適切なイベントハンドリング

## ライセンス

このプロジェクトのライセンスに従います。
